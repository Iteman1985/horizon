#!/bin/sh -u

band=$1
mac_addr=$2
reason=$3

if [ $# != 3 ]; then
    echo "usage: $0 <band> <MAC address> <reason>"
    exit 1
fi

if [ "$band" != "5.2GHz" ]; then
    # celeno client can be found only on 5.2GHz
    exit 1
fi

if [ "$( nvram_get ethConvert )" = "1" ]; then
    DISSASSOC_REASON_FACTORY_RESET=20000

    if [ "$reason" = "$DISSASSOC_REASON_FACTORY_RESET" ]; then
        echo > /dev/console
        echo "$0: drop connection due to factory reset on AP" > /dev/console
        echo > /dev/console

        iwpriv ra0 set SSID=""
        nvram_set SSID1 ""

        reset_autoassign_flags.sh

        #Erasing flag that means uboot got RSN credentials
        nvram_set uboot "RescueGotCredentials" "0"
    fi
fi
